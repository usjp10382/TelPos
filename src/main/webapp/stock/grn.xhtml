<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:pe="http://primefaces.org/ui/extensions"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:p="http://primefaces.org/ui">

<h:body>

	<ui:composition template="/template/common/commonLayout.xhtml">
		<ui:define name="content">
			<!-- <p:ajaxStatus onstart="PF('statusDialog').show()"
				onsuccess="PF('statusDialog').hide()" />

			<p:dialog widgetVar="statusDialog" modal="true" draggable="false"
				closable="false" resizable="false" showHeader="false">
				<p:graphicImage value="../resources/img/ajax-loader.gif" />
			</p:dialog> -->
			<h:form id="grnFrm" prependId="false"
				onkeypress="if (event.keyCode == 13) { return false; }">
				<p:growl id="growl" sticky="false" life="5000" showDetail="true"
					showSummary="false" />
				<!-- GRN Main - Start -->
				<div class="p-grid">
					<div class="p-col-12">
						<p:fieldset legend="Good Received Note" style="margin-bottom:20px">

							<p:wizard flowListener="#{grnController.handleFlow}">

								<!-- GRN Details (1st Tab) - Start -->
								<p:tab id="tabOne" title="GRN Details">
									<p:panel header="Main Details">
										<p:focus for="comment" id="commentFocus" />
										<p:messages />

										<div class="p-grid">

											<div class="p-col-6">

												<div class="p-grid">

													<div class="p-col-12">
														<p:outputLabel for="@next" value="GRN No" />
														<br />
														<p:inputText id="grnNo" readonly="true" required="false"
															value="#{grnController.nextGrnNumber}" style="width:76%">
															<f:convertNumber pattern="0000" />
														</p:inputText>
													</div>

													<div class="p-col-12">
														<p:outputLabel for="@next" value="Badge No" />
														<br />
														<p:inputText id="badgeNo" readonly="true" required="false"
															value="#{grnController.nextBatchNumber}"
															style="width:76%">
															<f:convertNumber pattern="0000" />
														</p:inputText>
													</div>

													<div class="p-col-12">
														<p:outputLabel for="@next" value="Date" />
														<br />
														<p:inputText id="dateId" required="true" readonly="true"
															value="#{grnController.grnHdr.createDate}"
															style="width:76%">
															<f:convertDateTime pattern="yyyy-MMM-dd" />
														</p:inputText>
													</div>

												</div>
											</div>

											<div class="p-col-6">

												<div class="p-grid">

													<div class="p-col-12">
														<p:outputLabel for="@next" value="Comment" />
														<br />
														<p:inputText id="comment" style="width:76%"
															value="#{grnController.grnHdr.remark}" />
													</div>

													<div class="p-col-12">
														<h:panelGrid columns="2" width="90%">
															<p:outputLabel for="@next" value="Supplier" />
															<br />
															<p:selectOneMenu style="width:100%" id="supName"
																effect="fold" required="true"
																requiredMessage="Select Suppliyer Is Required"
																filter="true" editable="true" converter="suppConvertor"
																placeholder="- Select Suppliyer -"
																value="#{grnController.selSuppliyer}">
																<f:selectItems
																	value="#{grnController.allActiveSuppliyers}" var="supp"
																	itemValue="#{supp}" itemLabel="#{supp.supplierName}" />
															</p:selectOneMenu>

															<p:commandButton icon="fa fa-info-circle"
																title="View Supplier Details" styleClass="info-btn">
															</p:commandButton>
														</h:panelGrid>
													</div>

													<div class="p-col-12">
														<p:outputLabel for="@next" value="Create By" />
														<br />
														<p:inputText id="cBy" readonly="true" required="false"
															value="#{grnController.grnHdr.createBy}"
															style="width:76%" />
													</div>

												</div>
											</div>

										</div>

									</p:panel>
								</p:tab>
								<!-- GRN Details (1st Tab) - End -->

								<!-- Item Details (2nd Tab) - Start -->
								<p:tab id="tabTwo" title="Item Details">
									<p:panel header="Add Items" id="pnlGrnDet">
										<p:focus for="itemSelect" id="prdFocus" />
										<!-- Top Icon Button - Start -->
										<div class="p-grid">
											<div class="p-col-12" align="right">
												<div style="display: inline;">
													<p:commandButton icon="fa fa-shopping-cart"
														style="margin-right:5px;background:#e02365;border:none"
														type="button" id="newItem"
														onclick="PF('pdfSheet').show();" title="Add New Item">
													</p:commandButton>
												</div>
											</div>
										</div>
										<!-- Top Icon Button - End -->

										<p:messages showDetail="true" showSummary="true"
											skipDetailIfEqualsSummary="true" closable="true" />

										<div class="p-grid">

											<div class="p-col-12">

												<!-- Item Details Item Select - Start -->
												<div>
													<h:panelGrid columns="2">
														<p:outputLabel for="@next" value="Item" />
														<br />
														<p:autoComplete id="itemSelect" dropdown="true" size="40"
															value="#{grnController.selProduct}" var="prd"
															forceSelection="true" queryDelay="700"
															widgetVar="autocomplete" itemLabel="#{prd.prdName}"
															minQueryLength="2" itemValue="#{prd}"
															completeMethod="#{grnController.completeProductsContains}"
															onkeypress="if (event.keyCode == 13) {PF('qtyFil').jq.focus(); return false; }"
															converter="prdConvertor">
															<p:ajax event="itemSelect"
																listener="#{grnController.onItemSelect}" />
														</p:autoComplete>

														<p:commandButton icon="fa fa-info-circle"
															title="View Item Details" styleClass="info-btn">
														</p:commandButton>
														<br />
													</h:panelGrid>
												</div>
												<!-- Item Details Item Select - End -->

												<!-- Item Details Text Fields - Start -->
												<div class="p-grid">

													<div class="p-col-2">
														<p:outputLabel for="@next" value="Quantity" />
														<br />
														<p:inputText id="qty" value="#{grnController.qty}"
															onkeypress="if (event.keyCode == 13) {PF('expPick').jq.focus(); return false; }"
															widgetVar="qtyFil" style="width:100%" type="number" />
													</div>

													<div class="p-col-2">
														<p:outputLabel for="@next" value="Expire Date" />
														<br />
														<p:datePicker id="expDate" style="width:100%"
															widgetVar="expPick" value="#{grnController.expDate}"
															onselect="PF('uniPriFil').jq.focus();"
															mindate="#{grnController.minExpDate}" />
													</div>

													<div class="p-col-2">
														<p:outputLabel for="@next" value="Unit Price" />
														<br />
														<p:inputText id="uniPrice" type="number"
															widgetVar="uniPriFil" value="#{grnController.untiPrice}"
															style="width:100%" />
													</div>

													<div class="p-col-2">
														<p:outputLabel for="@next" value="Discount %" />
														<br />
														<h:inputText type="number" id="dis"
															style="width:100%; height:60%"
															value="#{grnController.discount}" maxlength="2" />
													</div>
													<p:remoteCommand name="addCrt"
														action="#{grnController.addToCart}"
														process="@this pnlGrnDet" update=":grnFrm:pnlGrnDet" />

													<div class="p-col-2">
														<p:outputLabel for="@next" value="MRP" />
														<br />
														<p:inputText id="sellPrice" style="width:100%"
															type="number" value="#{grnController.mrp}"
															onkeypress="if (event.keyCode === 13) { addCrt(); return false; }" />
													</div>



													<div class="p-col-6"></div>

													<div class="p-col-4" align="right">
														<p:commandButton value="Add to Table"
															action="#{grnController.addToCart}"
															process="@this pnlGrnDet" update=":grnFrm:pnlGrnDet"
															style="width:105%" />

													</div>

												</div>
												<!-- Item Details Text Fields - End -->

											</div>

										</div>

										<p:separator />

										<!-- Table - Start -->
										<div class="p-grid">
											<div class="p-col-12">

												<p:dataTable resizableColumns="true" var="grnDet"
													value="#{grnController.grnDets}" id="grnDet">
													<p:column headerText="Item No">
														<h:outputText value="#{grnDet.grnDetNumber}" />
													</p:column>

													<p:column headerText="Item Code">
														<h:outputText value="#{grnDet.product.prdCode}" />
													</p:column>

													<p:column headerText="Description">
														<h:outputText value="#{grnDet.product.prdName}" />
													</p:column>

													<p:column headerText="Qty">
														<h:outputText value="#{grnDet.qty}" />
													</p:column>

													<p:column headerText="Expire Date">
														<h:outputText
															value="#{empty grnDet.expireDate?'N/A':grnDet.expireDate}">
															<f:convertDateTime type="date" pattern="YYYY-MM-dd" />
														</h:outputText>
													</p:column>

													<p:column headerText="unit price">
														<h:outputText value="#{grnDet.unitPrice}" />
													</p:column>

													<p:column headerText="discount">
														<h:outputText
															value="#{empty grnDet.discount?'N/A':grnDet.discount}" />
													</p:column>

													<p:column headerText="Net Price">
														<h:outputText value="#{grnDet.netPrice}" />
													</p:column>

													<p:column headerText="Selling price">
														<h:outputText value="#{grnDet.sellingPrice}" />
													</p:column>


													<p:column headerText="Total">
														<h:outputText value="#{grnDet.subTotal}" />
													</p:column>

													<p:column style="width:32px;text-align: center">
														<p:commandButton icon="pi pi-trash" title="Delete"
															process="grnDet" update="growl,grnDet"
															style="width:20px;height:20px" styleClass="red-button">
															<f:setPropertyActionListener value="#{grnDet}"
																target="#{grnController.remGrnDet}" />
															<p:confirm header="Remove GRN Item"
																message="Are You Sure GRN Item From Cart?"
																icon="pi pi-trash" />
														</p:commandButton>
													</p:column>
												</p:dataTable>

											</div>
										</div>
										<!-- Table - End -->
									</p:panel>
								</p:tab>
								<!-- Item Details (2nd Tab) - End -->

								<p:tab id="payDet" title="Payment Details">
									<p:panel header="Payment And Adjust Total Discount">
										<p:messages showDetail="true" showSummary="true"
											skipDetailIfEqualsSummary="true" closable="true" />
										<div class="p-grid" style="margin-top: 10px">

											<div class="p-col-3" align="center"
												style="border-right: solid blue 1px;">

												<h2>Total Amount</h2>
												<h3>
													<p:outputLabel value="#{grnController.grnHdr.totalValue}">
														<f:convertNumber type="currency" currencySymbol="LKR " />
													</p:outputLabel>
												</h3>
												<p:separator />
												<h2>Paybale Amount</h2>
												<h3>
													<p:outputLabel id="payAmount"
														value="#{grnController.grnHdr.paybleAmount}">
														<f:convertNumber type="currency" currencySymbol="LKR " />
													</p:outputLabel>
												</h3>
												<p:separator />
												<h2>Balance</h2>
												<h3>
													<p:outputLabel value="#{grnController.grnHdr.balance}"
														id="grnBal">
														<f:convertNumber type="currency" currencySymbol="LKR " />
													</p:outputLabel>
												</h3>
											</div>

											<div class="p-col-5">

												<div class="p-col-12">
													<p:outputLabel for="@next" value="Discount (%)" />
													<br />
													<p:inputText id="disFull" type="number"
														value="#{grnController.grnHdr.grnValDiscount}"
														style="width:77%">
														<p:ajax event="keyup" update="payAmount,grnBal"
															listener="#{grnController.handleDiscountKeyEvent}" />
													</p:inputText>
												</div>

												<div class="p-col-12">
													<p:outputLabel for="@next" value="Payment Type" />
													<br />
													<p:selectOneMenu style="width:77%" id="pType" effect="fold"
														required="true"
														requiredMessage="Select Payment Type Is Required"
														filter="true" editable="true" converter="payConvertor"
														placeholder="- Select Payment Type -"
														value="#{grnController.selPayType}">
														<f:selectItems value="#{grnController.paymentTypes}"
															var="paytyp" itemValue="#{paytyp}"
															itemLabel="#{paytyp.desc}" />
													</p:selectOneMenu>
												</div>

												<div class="p-col-12">
													<p:outputLabel for="@next" value="Cash Amount" />
													<br />
													<p:inputText id="paidAmountCash" style="width:77%" />
												</div>

												<div class="p-col-12">
													<p:outputLabel for="@next" value="Cheque Amount" />
													<br />
													<p:inputText id="paidAmountCheque" style="width:77%" />
												</div>

											</div>

										</div>
									</p:panel>
								</p:tab>

								<!-- Payment Details (3rd Tab) - Start -->
								<p:tab id="confirm" title="Confirmation">
									<p:panel header="Biling Details and Confirmation"
										id="pnlConfirm">
										<div class="p-grid">

											<!-- GRN Printing Version - Start -->
											<div class="p-col-12"
												style="border: 2px solid #74C0F3; margin-top: 5px"
												id="print-area">

												<div align="center">
													<h1>Good Recive Note</h1>
												</div>
												<p:separator />
												<div class="p-grid">
													<div class="p-col-6" style="line-height: 0">
														<div class="p-grid">
															<!-- Grn Header Details - Printing - Start -->
															<div class="p-col-4">
																<h4>GRN ID</h4>
																<h4>Badge</h4>
																<br />
																<h4>Date</h4>
																<h4>Supplier</h4>
															</div>
															<div class="p-col-1">
																<h4>:</h4>
																<h4>:</h4>
																<br />
																<h4>:</h4>
																<h4>:</h4>
															</div>
															<div class="p-col-7">
																<h4>
																	<p:outputLabel value="#{grnController.nextGrnNumber}">
																		<f:convertNumber pattern="0000" />
																	</p:outputLabel>
																</h4>
																<h4>
																	<p:outputLabel value="#{grnController.nextBatchNumber}">
																		<f:convertNumber pattern="0000" />
																	</p:outputLabel>
																</h4>
																<br />
																<h4>
																	<p:outputLabel
																		value="#{grnController.grnHdr.createDate}">
																		<f:convertDateTime type="date" pattern="yyyy-MM-dd" />
																	</p:outputLabel>
																</h4>
																<h4>
																	<p:outputLabel
																		value="#{grnController.selSuppliyer.supplierName}" />
																</h4>
															</div>
															<!-- Grn Header Details - Printing - End -->
														</div>
													</div>
												</div>
												<!-- Grn Table - Printing - Start -->
												<div class="p-col-12">
													<p:dataTable var="itemDetailsTwo"
														value="#{dtBasicView.cars}" id="itemDetailsTableTwo">
														<p:column headerText="Item No">
															<h:outputText value="#{car.id}" />
														</p:column>

														<p:column headerText="Item Code">
															<h:outputText value="#{car.year}" />
														</p:column>

														<p:column headerText="Description">
															<h:outputText value="#{car.brand}" />
														</p:column>

														<p:column headerText="Qty">
															<h:outputText value="#{car.color}" />
														</p:column>

														<p:column headerText="Expire Date">
															<h:outputText value="#{car.color}" />
														</p:column>

														<p:column headerText="unit price">
															<h:outputText value="#{car.color}" />
														</p:column>

														<p:column headerText="Selling price">
															<h:outputText value="#{car.color}" />
														</p:column>

														<p:column headerText="discount">
															<h:outputText value="#{car.color}" />
														</p:column>

														<p:column headerText="Total">
															<h:outputText value="#{car.color}" />
														</p:column>
													</p:dataTable>
												</div>
												<!-- Grn Table - Printing - End -->

												<!-- GRN Footer - Printing - Start -->
												<div class="p-col-12">
													<table align="right" style="font-weight: bold; width: 30%">
														<tr>
															<td>Total Amount</td>
															<td>-</td>
															<td align="right">1000.00</td>
														</tr>
														<tr>
															<td>Discount</td>
															<td>-</td>
															<td align="right">10<span>%</span></td>
														</tr>
														<tr>
															<td>Payble Amount</td>
															<td>-</td>
															<td align="right">1000.00</td>
														</tr>
														<tr>
															<td>Paid Amount</td>
															<td>-</td>
															<td align="right">1000.00</td>
														</tr>
														<tr>
															<td>Balance</td>
															<td>-</td>
															<td align="right">1000.00</td>
														</tr>
													</table>
												</div>
												<!-- GRN Footer - Printing - End -->

											</div>
											<!-- GRN Printing Version - End -->

											<!-- Payment type and comment - Start -->
											<div class="p-grid">
												<div class="p-col-12">
													<h4>
														Payment Type : <span>
															#{grnController.selPayType.desc} </span>
													</h4>
													<p>
														<span style="color: red">*</span>#{empty
														grnController.grnHdr.remark?'N/A':grnController.grnHdr.remark}
													</p>
												</div>
											</div>
											<!-- Payment type and comment - End -->

										</div>
										<div align="right">
											<p:commandButton style="width:15%" value="Create GRN"
												id="createGrn" styleClass="green-button" icon="fa fa-check" />
											<p:commandButton style="width:15%" value="Print This"
												action="#{grnController.printGrn}" id="printThis"
												ajax="false" onclick="this.form.target='_blank'"
												styleClass="orange-btn" icon="fa fa-print" />
											<p:commandButton style="width:15%" value="Send This"
												id="sendThis" icon="fa fa-envelope" />
										</div>
									</p:panel>
								</p:tab>
								<!-- Payment Details (3rd Tab) - End -->

							</p:wizard>

						</p:fieldset>
					</div>
				</div>
				<!-- GRN Main - End -->



				<p:confirmDialog global="true" showEffect="expLode"
					hideEffect="fade">
					<p:commandButton value="#{msg['tel.pos.cwc.msg.yes.btn']}"
						type="button" styleClass="red-button ui-confirmdialog-yes"
						icon="pi pi-check" />
					<p:commandButton value="#{msg['tel.pos.cwc.msg.no.btn']}"
						type="button" styleClass="green-button ui-confirmdialog-no"
						icon="pi pi-times" />
				</p:confirmDialog>
			</h:form>
		</ui:define>
	</ui:composition>

</h:body>
</html>


